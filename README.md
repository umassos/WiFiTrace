# WiFiTrace: Network-centric WiFi Contact Tracing

WiFiTrace is a network-centric contact tracing method that uses enterprise WiFi networks for contact tracing in office and campus settings. Unlike bluetooth-based methods, it does not require an app to be installed on user phones and instead uses syslog data generated by enterprise WiFi access points to trace locations within office/campus buildings that an infected user has visited. It can also report other users who were seen for a period of time near those access points.

WiFiTrace is an open-source project led by Computer Science researchers at the University of Massachusetst Amherst. The project has a website at : http://wifitrace.github.io/ 

The tool and algorithm leverages our prior expertise in mobility modeling and modeling mobile trajectories to efficiently perform these computations on syslog WiFi data.

## How it works

WiFiTrace is designed primarily for contact tracing inside buildings within university and corporate campuses. It uses network monitoring data,  such as Syslog and SNMP data, that are typically gathered by an institution's IT department for purposes of network performance and security monitoring and leverages it for contact tracing.

In the event an employee or a student comes down sick, this data can be used to determine the campus buildings and locations within a building visited by the infected user over the infection period. It can also be used to analyze other users who may have been present at those locations during that period.

WiFiTrace uses Access Point (AP) association and disassociation information from syslogs, SNMP, and RTLS reports for contact tracing. It assumes that users have mobile devices that are connected to a ubiquitous WiFi network. As the user visits different buildings or different rooms over the course of the day, their device connect to different access points, allowing the tool to reconstruct their path and visited locations. Devices from other users that were associated with those APs at those times can also be analyzed to determine risk to other users.

## Differences with bluetooth-based approaches

WiFiTrace is a complementary approach to bluetooth-based methods for contact tracing. It does not require any app to be downloaded by users to their phones, nor does it require any data to be recorded on the user's device.

It is a network-centric approach that uses the network's view of users to infer their locations. WiFiTrace only works with enterprise WiFi networks and is primarily designed for large indoor environments with WiFi coverage (campuses, office buildings, shopping malls).  It does not work with most consumer-grade WiFi routers, such as ones deployed at home, since it assumes RADIUS authentication to associate a device to a specific user. 

It is designed for indoor contact tracing, and unlike bluetooth methods, it does not work outdoors (unless there is WiFi covrage in those outdoor areas).  

## Design of WiFiTrace 

The tool uses a modular architecture to make it compatible with WiFi devices from different networking vendors. 
The processor code processes raw networking monitoring logs/data to extract AP association/disassociation information and outputs it to a standard data format.  Currently, we provide a pre-processor for syslogs produced for HP/Aruba WiFi devices. Support for other vendors is a work in progress.  The output data format is fully documented so that others can write/contribute pre-processing scripts for other vendors.

The main tool then ingests this data in a standard format and  generates contact tracing reports  it based on a specified user or a device MAC address. The output report can be in human-readable text or JSON format.


 

# Installation and Usage
## Sections
- [Dependencies & Installation](https://github.com/WiFiTrace/WiFiTrace.github.io/blob/master/installation.md#dependencies-and-installation)
- [Directory Structure & File Name Format](https://github.com/WiFiTrace/WiFiTrace.github.io/blob/master/installation.md#directory-structure-and-file-name-format)
- [Data Format](https://github.com/WiFiTrace/WiFiTrace.github.io/blob/master/installation.md#data-format)
- [Example Usage](https://github.com/WiFiTrace/WiFiTrace.github.io/blob/master/installation.md#usage)
- [References](https://github.com/WiFiTrace/WiFiTrace.github.io/blob/master/installation.md#references)

## Dependencies and Installation
The code works with Python 3.7 and is also Python 2.7 compatible. You need to install Python (3.7 preferred) and the following list of packages:
  * [Pandas](https://pandas.pydata.org/pandas-docs/stable/getting_started/install.html)
  * datetime, os, ast, sys, get_opt are all part of python’s standard library.
  
## Code can be found [here](https://github.com/umassos/WiFiTrace)
  
## Directory Structure and File Name Format

### Contact Tracing Tool:
The directory structure of WiFiTrace code is as follows:

\WiFiTrace  
&nbsp;&nbsp;&nbsp;&nbsp;- \src  
&nbsp;&nbsp;&nbsp;&nbsp;- \util  

code directory : This directory has all the python code / script files  
util directory : This directory has additional python scripts for more maniputlations that can be done on the data 

The tool auto generates 2 directories to save the output (reports) as well as temporary file generated by the tool. These dirs are created in the location specified by the user in the config file.

idir : user specified dir in the config file  
&nbsp;&nbsp;&nbsp;&nbsp;- \reports (auto generated)  
&nbsp;&nbsp;&nbsp;&nbsp;- \temp_session (auto generated)  

reports directory : The patient location visit report and user colocation reports generated by the tool are stored in here. The Patient report naming convention is `Patient_Report_<Patient_MAC_ID>_<date>.txt` while the user colocation report naming convention is `User_Report_<Patient_MAC_ID>_<date>.txt`.  
temp_session : This directory has temporary files created by the tool.  

### Preprocessor : (WiFi Syslogs to Session Extraction System)

The directory structure of Preprocessor is as follows:

\Preprocessor  
&nbsp;&nbsp;&nbsp;&nbsp;- \src  
&nbsp;&nbsp;&nbsp;&nbsp;- \util  

src directory : This directory has all the python code/script files  
util directory : This directory has additional python scripts for doing postprocessing on the output file.  

## Data Format

### WiFiTrace : Contact Tracing Tool

**Input Data Format :** 

The input to WiFiTrace is a csv file where each row of the csv file represents a device session.
The columns in the csv file are:

  MAC,Session_AP_Name,Year,Month,Date,Start_Time,End_Time,Unix_Start_Time,Unix_End_Time

Field Description:

    MAC: (MAC Id of the device)
    Session_AP_Name: Access Point Name/ID where device was connected
    Year: YYYY
    Month: MMM (eg: Jan, Feb, Mar, etc)
    Date: DD (01-31)
    Start_Time : Start time of session in HH:MM (24-hr format)
    End_Time : End time of session in HH:MM (24-hr format)
    Unix_Start_Time : Start time of session in Unix Timestamp
    Unix_End_Time : End time of session in Unix Timestamp

**Note:**
* The input file to WiFiTrace is the output file of Preprocessor. So, if you have HP Aruba WiFi Solution go ahead and use the preprocessor to create the session input file to WiFiTrace.

**Output Data Format :**

The output of WiFiTrace are Patient report and User Co-location report, explained in the [Reports section]().

### Preprocessor : WiFi Syslogs to Sessions Extraction System:

**Input Data Format :**

HP Aruba WiFi log Format: The WiFi log of HP Aruba also called syslog file contains a list of events.
A typical event message in the Wifi log/syslog looks as below:

hh:mm:ss <controller_name> <process_id> <message_subtype> <controller_name masked_IP> <message_body>

This is the log file generated by HP Aruba WiFi Access Point. It is the input file to extract trajectories from WiFi logs.

**Output Data Format :**

The Preprocessor generates a csv file . Each row of the csv file represents a device session.
The columns in the csv file are 

  MAC,Session_AP_Name,Year,Month,Date,Start_Time,End_Time,Unix_Start_Time,Unix_End_Time

Field Description:

    MAC: (MAC Id of the device)
    Session_AP_Name: Access Point Name/ID where device was connected
    Year: YYYY
    Month: MMM (eg: Jan, Feb, Mar, etc)
    Date: DD (01-31)
    Start_Time : Start time of session in HH:MM (24-hr format)
    End_Time : End time of session in HH:MM (24-hr format)
    Unix_Start_Time : Start time of session in Unix Timestamp
    Unix_End_Time : End time of session in Unix Timestamp
    
    
## Usage
### WiFiTrace (Contact Tracing Tool):

python main.py -m <\mac id\> -s \<start date YYYYMMDD \> -e \<end date YYYYMMDD \> -w \<pathogen active window size\> -l \<minimum session length (in mins) of the infected patient\>

where:  
m - mac id of the infected patient  
s - This is the date from when you want to perform contact tracing  
e - This is the date till when you want to perform contact tracing  
w - Time in hours for which the pathogen is active, if you want to perform contact tracing to identify users who visited the location after the departure of the infected person when the pathogens spread by the infected person are still alive. Default value 0, indicating the infected person and other users should be co-located at the same place and at the same time.  
l - Minimum time in mins spend by the infected person at a location. Default value 0, indicating consider all locations visited by the infected person irrespective of the time spend at each location.  

Also, **change the value of parameter idir in config.text file to indicate the location of all input session files.**

**For Example:**

* To generate the contact trace for a mac_id "0x-DE-AD-BE-EF” for dates starting from 19-Jan-2020 till 24-Jan-2020 and the pathogen active window is 2 hrs (time window for which the pathogen is active even after the infected patient leaves the location) and the infected person must have spend atleast 5 mins at each location, we would run the python script as below:

    python main.py -m "0x-DE-AD-BE-EF" -s 20200119 -e 20200124 -w 1 -l 5  

    If you want strict co-location then, enter window size as 0 ( -w 0 )  

If the input sessions files are at /Users/foo/, change idir value in config.txt to
idir=/Users/foo/

### Preprocessor (Syslog to Session File):

python main.py -y \<YYYY\> -i \<input\> -o \<output\>

where:  
i - input syslog file name or directory (if multiple files to be preprocessed)  
o - output file name or directory  
y - Year (YYYY format) of the syslog file passed in -i, default is current year  

**Note:**
1. If Output file parameter -o option is a directory then the outfile is saved as a <input_filename>_sessions.csv

Example:
main.py -y 2019 -i /data/20190111_syslog -o /session/

will process the syslog file present at location /data/20190111_syslog and create an output file in /session/ dir with name 20190111_syslog_sessions.csv

2. If Input parameter is a directory then the script processes all syslog files in the directory that haven't been processed earlier and generates the corresponding session output files.

### References
